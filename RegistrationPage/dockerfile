FROM tomcat:9-jdk11

# Set working directory
WORKDIR /app

# Copy entire project
COPY . /app

# Copy JDBC driver to Tomcat's lib directory
COPY WebContent/WEB-INF/lib/mssql-jdbc-11.2.0.jre11.jar /usr/local/tomcat/lib/

# Create WAR file
RUN mkdir -p /usr/local/tomcat/webapps/weather \
    && cd /app \
    && jar -cvf /usr/local/tomcat/webapps/weather.war WebContent/*

# Ensure correct permissions
RUN chmod +x /usr/local/tomcat/bin/*.sh

# Expose Tomcat port
EXPOSE 8080

# Start Tomcat with verbose logging
CMD ["catalina.sh", "run"]